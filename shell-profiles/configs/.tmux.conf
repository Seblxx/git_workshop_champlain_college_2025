# Git Workshop Tmux Configuration
# Enhanced terminal multiplexer setup for Git workflows

# Change prefix key to Ctrl-a (more convenient than Ctrl-b)
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# Basic settings
set -g default-terminal "screen-256color"
set -g history-limit 10000
set -g base-index 1
set -g pane-base-index 1
set -g renumber-windows on
set -g allow-rename off
set -g mouse on

# Key bindings
# Reload config
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# Split panes
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Navigate panes with vim-like keys
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize panes
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Window navigation
bind -n M-h previous-window
bind -n M-l next-window

# Copy mode with vim bindings
setw -g mode-keys vi
bind v copy-mode
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key -T copy-mode-vi 'y' send -X copy-selection-and-cancel

# Status bar configuration
set -g status on
set -g status-interval 1
set -g status-justify centre
set -g status-style fg=white,bg=colour234

# Left status (session name)
set -g status-left-length 40
set -g status-left "#[fg=colour39]#S #[fg=colour245]| "

# Right status (Git info and time)
set -g status-right-length 80
set -g status-right "#[fg=colour245]#{?window_bigger,[#{window_offset_x}#,#{window_offset_y}] ,}#[fg=colour136]#(cd #{pane_current_path}; git branch --show-current 2>/dev/null | sed 's/^/ /') #[fg=colour245]| #[fg=colour39]%H:%M:%S"

# Window status
setw -g window-status-format "#[fg=colour245] #I:#W "
setw -g window-status-current-format "#[fg=colour39,bold] #I:#W "

# Pane borders
set -g pane-border-style fg=colour240
set -g pane-active-border-style fg=colour39

# Message style
set -g message-style fg=colour39,bg=colour234

# Git-specific session layouts
# Layout 1: Main work area with git status
bind G new-window -n "git-workspace" \; \
       split-window -h -p 30 \; \
       send-keys "watch -n 1 'git status --short'" Enter \; \
       select-pane -L

# Layout 2: Three pane setup for git workflow
bind W new-window -n "git-flow" \; \
       split-window -h -p 66 \; \
       split-window -v \; \
       select-pane -L \; \
       send-keys "git log --oneline --graph -10" Enter \; \
       select-pane -R \; \
       select-pane -U \; \
       send-keys "git status" Enter \; \
       select-pane -D \; \
       send-keys "git diff --name-only" Enter \; \
       select-pane -L

# Quick Git commands
bind g command-prompt -p "Git command:" "send-keys 'git %1' Enter"
bind s send-keys "git status" Enter
bind d send-keys "git diff" Enter
bind a send-keys "git add ." Enter
bind c command-prompt -p "Commit message:" "send-keys 'git commit -m \"%1\"' Enter"
bind p send-keys "git push" Enter
bind u send-keys "git pull" Enter

# Session management for different projects
bind P command-prompt -p "Project name:" "new-session -d -s %1; switch-client -t %1"

# Copy current Git branch to clipboard (requires xclip on Linux or pbcopy on macOS)
bind B run-shell "cd #{pane_current_path}; git branch --show-current | tr -d '\\n' | xclip -selection clipboard || git branch --show-current | tr -d '\\n' | pbcopy"

# Show Git log in a popup
bind M-g display-popup -E -w 80% -h 80% -d "#{pane_current_path}" "git log --oneline --graph --all --decorate | less"

# Show Git diff in a popup
bind M-d display-popup -E -w 80% -h 80% -d "#{pane_current_path}" "git diff | less"

# Activity monitoring
setw -g monitor-activity on
set -g visual-activity off

# Automatic window renaming based on current command
setw -g automatic-rename on
setw -g automatic-rename-format '#{b:pane_current_path}'

# Enable focus events for vim integration
set -g focus-events on

# Escape time for vim
set -sg escape-time 0

# Plugin management (install TPM first: git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm)
# set -g @plugin 'tmux-plugins/tpm'
# set -g @plugin 'tmux-plugins/tmux-sensible'
# set -g @plugin 'tmux-plugins/tmux-resurrect'
# set -g @plugin 'tmux-plugins/tmux-continuum'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
# run '~/.tmux/plugins/tpm/tpm'
